<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>
      Invoice
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body style="Margin:0;padding:0;background:#ffffff;color:#111111;">
    <!-- Top rule -->
    <table
      role="presentation"
      width="100%"
      cellpadding="0"
      cellspacing="0"
      border="0"
      style="border-collapse:collapse;"
    >
      <tr>
        <td style="height:6px;background:#111111;">
        </td>
      </tr>
    </table>

    <!-- Outer container -->
    <table
      role="presentation"
      width="100%"
      cellpadding="0"
      cellspacing="0"
      border="0"
      style="border-collapse:collapse;"
    >
      <tr>
        <td align="center" style="padding:18px 10px;">
          <table
            role="presentation"
            width="640"
            cellpadding="0"
            cellspacing="0"
            border="0"
            style="border-collapse:collapse;width:640px;"
          >

            <!-- Header: Logo/Company Info (Left) and Invoice Number (Right) -->
            <tr>
              <td>
                <table
                  role="presentation"
                  width="100%"
                  cellpadding="0"
                  cellspacing="0"
                  border="0"
                  style="border-collapse:collapse;"
                >
                  <tr>
                    <!-- Left: Logo and Company Info -->
                    <td valign="top" width="50%" style="padding:0 10px 10px 0;">
                      @if(businessInfo?.logo?.url)
                        <img
                          src="{{ businessInfo.logo.url.startsWith('http') ? businessInfo.logo.url : (baseUrl + businessInfo.logo.url) }}"
                          alt="Kabin247 Logo"
                          width="180"
                          style="display:block;border:0;outline:none;text-decoration:none;height:auto;max-width:180px;margin-bottom:8px;"
                        />
                      @else
                        <img
                          src="{{ baseUrl || 'https://app.kabin247.com' }}/logo.png"
                          alt="Kabin247 Logo"
                          width="180"
                          style="display:block;border:0;outline:none;text-decoration:none;height:auto;max-width:180px;margin-bottom:8px;"
                        />
                      @endif
                      <div style="font-family:Arial,Helvetica,sans-serif;font-size:12px;color:#333;line-height:16px;">
                        <div style="font-weight:bold;font-size:14px;margin-bottom:4px;">Kabin247</div>
                        <div>4520 W Oakellar Ave Unit 13061</div>
                        <div>Tampa, FL 33611</div>
                        <div style="margin-top:4px;">Phone: 8133315667</div>
                      </div>
                    </td>

                    <!-- Right: Invoice Number and Delivery Info -->
                    <td valign="top" width="50%" align="right" style="padding:0 0 10px 10px;">
                      <!-- Invoice Number -->
                      <div style="font-family:Arial,Helvetica,sans-serif;font-size:11px;color:#333;margin-bottom:12px;text-align:right;">
                        <strong>INVOICE: #{{ order?.orderNumber || 'N/A' }}</strong>
                      </div>

                      <!-- Delivery Information (Compact) -->
                      <table
                        role="presentation"
                        width="100%"
                        cellpadding="0"
                        cellspacing="0"
                        border="0"
                        style="border:1px solid #e1e5ea;border-collapse:collapse;font-family:Arial,Helvetica,sans-serif;font-size:10px;color:#333;"
                      >
                        <tr>
                          <td style="padding:6px 8px;background:#f2f6fb;font-weight:bold;font-size:10px;">
                            DELIVERY INFO
                          </td>
                        </tr>
                        <tr>
                          <td style="padding:6px 8px;line-height:14px;">
                            @if(order?.deliveryAirport)
                              <div><strong>{{ order.deliveryAirport.fboName || order.deliveryAirport.name || 'N/A' }}</strong></div>
                              @if(order.deliveryAirport.iataCode || order.deliveryAirport.icaoCode)
                                <div style="font-size:9px;color:#666;">
                                  {{ order.deliveryAirport.iataCode || '' }}{{ (order.deliveryAirport.iataCode && order.deliveryAirport.icaoCode) ? ' / ' : '' }}{{ order.deliveryAirport.icaoCode || '' }}
                                </div>
                              @endif
                            @else
                              <div>N/A</div>
                            @endif
                            @if(order?.deliveryDate)
                              <div style="margin-top:4px;font-size:9px;">
                                <strong>Date:</strong> {{ order.deliveryDate }}{{ order?.deliveryTime ? ' at ' + order.deliveryTime : '' }}
                              </div>
                            @endif
                            @if(order?.tailNumber)
                              <div style="margin-top:2px;font-size:9px;">
                                <strong>Tail#:</strong> <span style="color:#c20000;font-weight:bold;">{{ order.tailNumber }}</span>
                              </div>
                            @endif
                          </td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>

            <!-- Bill To Section (Left under logo) -->
            <tr>
              <td style="padding-top:8px;">
                <table
                  role="presentation"
                  width="100%"
                  cellpadding="0"
                  cellspacing="0"
                  border="0"
                  style="border-collapse:collapse;"
                >
                  <tr>
                    <td valign="top" width="50%" style="padding:0 10px 10px 0;">
                      <table
                        role="presentation"
                        width="100%"
                        cellpadding="0"
                        cellspacing="0"
                        border="0"
                        style="border:1px solid #e1e5ea;border-collapse:collapse;"
                      >
                        <tr>
                          <td
                            style="background:#f2f6fb;padding:6px 8px;font-family:Arial,Helvetica,sans-serif;font-size:11px;color:#1a3d7c;font-weight:bold;"
                          >
                            BILL TO
                          </td>
                        </tr>
                        <tr>
                          <td style="padding:8px;font-family:Arial,Helvetica,sans-serif;font-size:12px;color:#333;line-height:18px;">
                            @if(order?.user)
                              <div style="font-weight:bold;margin-bottom:4px;font-size:13px;">
                                {{ order.user.fullName || (order.user.firstName + ' ' + (order.user.lastName || '')) }}
                              </div>
                              @if(order.user.companyName)
                                <div style="margin-bottom:4px;font-weight:bold;">{{ order.user.companyName }}</div>
                              @endif
                              @if(order.user.email)
                                <div style="font-weight:bold;">Email: {{ order.user.email }}</div>
                              @endif
                              @if(order.user.phoneNumber)
                                <div style="font-weight:bold;">Phone: {{ order.user.phoneNumber }}</div>
                              @endif
                              @if(order.user.clientAddress)
                                <div style="margin-top:4px;">{{ order.user.clientAddress }}</div>
                              @elseif(order.user.airport)
                                <div style="margin-top:4px;">{{ order.user.airport.name || order.user.airport.fboName || '' }}</div>
                              @endif
                            @else
                              <div>Customer information not available</div>
                            @endif
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td valign="top" width="50%" style="padding:0 0 10px 10px;">
                      <!-- Additional Info Section (Compact) -->
                      <table
                        role="presentation"
                        width="100%"
                        cellpadding="0"
                        cellspacing="0"
                        border="0"
                        style="border:1px solid #e1e5ea;border-collapse:collapse;font-family:Arial,Helvetica,sans-serif;font-size:10px;color:#333;"
                      >
                        <tr>
                          <td style="padding:6px 8px;">
                            <div style="margin-bottom:4px;">
                              <strong>Invoice Date:</strong> {{ formattedDate || 'N/A' }}
                            </div>
                            <div style="margin-bottom:4px;">
                              <strong>Payment Method:</strong> 
                              <span style="text-transform:capitalize;">{{ order?.paymentType === 'card' ? 'Card' : (order?.paymentType === 'ach' ? 'ACH' : order?.paymentType?.toUpperCase() || 'N/A') }}</span>
                            </div>
                            @if(order?.note)
                              <div style="margin-top:4px;font-size:9px;">
                                <strong>Note:</strong> {{ order.note }}
                              </div>
                            @endif
                          </td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>

            <!-- Items table header -->
            <tr>
              <td style="padding-top:12px;">
                <table
                  role="presentation"
                  width="100%"
                  cellpadding="0"
                  cellspacing="0"
                  border="0"
                  style="border-collapse:collapse;"
                >
                  <tr>
                    <td
                      style="background:#0b63c9;color:#fff;font-family:Arial,Helvetica,sans-serif;font-size:13px;font-weight:bold;padding:10px;border:1px solid #0b63c9;"
                    >
                      Items & Description
                    </td>
                    <td
                      style="background:#0b63c9;color:#fff;font-family:Arial,Helvetica,sans-serif;font-size:13px;font-weight:bold;padding:10px;border:1px solid #0b63c9;text-align:center;white-space:wrap;"
                    >
                      Portions / Servings
                    </td>
                    <td
                      style="background:#0b63c9;color:#fff;font-family:Arial,Helvetica,sans-serif;font-size:13px;font-weight:bold;padding:10px;border:1px solid #0b63c9;text-align:center;"
                    >
                      Unit Cost
                    </td>
                    <td
                      style="background:#0b63c9;color:#fff;font-family:Arial,Helvetica,sans-serif;font-size:13px;font-weight:bold;padding:10px;border:1px solid #0b63c9;text-align:center;"
                    >
                      Item Cost
                    </td>
                  </tr>

                  <!-- Item rows (use itemsForPrint prepared in controller) -->
                  @if((itemsForPrint || []).length)
                    @each(it in itemsForPrint)
                      <tr>
                        <td
                          valign="top"
                          style="border:1px solid #e1e5ea;padding:10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111;"
                        >
                          <div style="font-weight:bold">
                            {{ it.name || 'N/A' }}
                          </div>
                          @if(it.description)
                            <div style="color:#666;font-size:12px;margin-top:2px;">
                              {{ it.description }}
                            </div>
                          @endif
                          
                          @each(line in (it.variantLines || []))
                            <div style="margin-top:4px;font-size:12px;color:#444;">
                              {{ line }}
                            </div>
                          @endeach
                          
                          @if(it.addonLine)
                            <div style="margin-top:4px;font-size:12px;color:#444;">
                              â€¢ {{ it.addonLine }}
                            </div>
                          @endif
                        </td>
                        <td
                          valign="top"
                          align="center"
                          style="border:1px solid #e1e5ea;padding:10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111;"
                        >
                          {{ it.quantity || 0 }}
                        </td>
                        <td
                          valign="top"
                          align="center"
                          style="border:1px solid #e1e5ea;padding:10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111;"
                        >
                          @if(businessInfo?.currencySymbolPosition === 'left')
                            {{ businessInfo?.currencyCode || 'USD' }} {{ it.unitCost || '0.00' }}
                          @else
                            {{ it.unitCost || '0.00' }} {{ businessInfo?.currencyCode || 'USD' }}
                          @endif
                        </td>
                        <td
                          valign="top"
                          align="center"
                          style="border:1px solid #e1e5ea;padding:10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111;"
                        >
                          @if(businessInfo?.currencySymbolPosition === 'left')
                            {{ businessInfo?.currencyCode || 'USD' }} {{ it.itemCost || '0.00' }}
                          @else
                            {{ it.itemCost || '0.00' }} {{ businessInfo?.currencyCode || 'USD' }}
                          @endif
                        </td>
                      </tr>
                    @endeach
                  @else
                    <!-- Fallback if itemsForPrint missing -->
                    <tr>
                      <td
                        colspan="4"
                        style="border:1px solid #e1e5ea;padding:10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111;"
                      >
                        N/A
                      </td>
                    </tr>
                  @endif
                  
                  <!-- Order-level charges -->
                  @each(c in (orderCharges || []))
                    <tr>
                      <td
                        colspan="3"
                        align="right"
                        style="border:1px solid #e1e5ea;padding:8px 10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111;"
                      >
                        {{ c?.name || 'Charge' }}
                      </td>
                      <td
                        align="center"
                        style="border:1px solid #e1e5ea;padding:8px 10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111; white-space:wrap;"
                      >
                        @if(businessInfo?.currencySymbolPosition === 'left')
                          {{ businessInfo?.currencyCode || 'USD' }} {{ Number(c?.amount || 0).toFixed(2) }}
                        @else
                          {{ Number(c?.amount || 0).toFixed(2) }} {{ businessInfo?.currencyCode || 'USD' }}
                        @endif
                      </td>
                    </tr>
                  @endeach
                  
                  <!-- Totals -->
                  <tr>
                    <td
                      colspan="3"
                      align="right"
                      style="border:1px solid #e1e5ea;padding:8px 10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111;"
                    >
                      Subtotal
                    </td>
                    <td
                      align="center"
                      style="border:1px solid #e1e5ea;padding:8px 10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111;white-space:wrap;"
                    >
                      @if(businessInfo?.currencySymbolPosition === 'left')
                        {{ businessInfo?.currencyCode || 'USD' }} {{ Number(order?.total || 0).toFixed(2) }}
                      @else
                        {{ Number(order?.total || 0).toFixed(2) }} {{ businessInfo?.currencyCode || 'USD' }}
                      @endif
                    </td>
                  </tr>

                  @if(order?.totalTax && Number(order.totalTax) > 0)
                    <tr>
                      <td
                        colspan="3"
                        align="right"
                        style="border:1px solid #e1e5ea;padding:8px 10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111;"
                      >
                        Tax
                      </td>
                      <td
                        align="center"
                        style="border:1px solid #e1e5ea;padding:8px 10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111;white-space:wrap;"
                      >
                        @if(businessInfo?.currencySymbolPosition === 'left')
                          {{ businessInfo?.currencyCode || 'USD' }} {{ Number(order.totalTax).toFixed(2) }}
                        @else
                          {{ Number(order.totalTax).toFixed(2) }} {{ businessInfo?.currencyCode || 'USD' }}
                        @endif
                      </td>
                    </tr>
                  @endif

                  @if(specialtyItemShoppingFee && Number(specialtyItemShoppingFee) > 0)
                    <tr>
                      <td
                        colspan="3"
                        align="right"
                        style="border:1px solid #e1e5ea;padding:8px 10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111;"
                      >
                        Specialty Item Shopping Fee
                      </td>
                      <td
                        align="center"
                        style="border:1px solid #e1e5ea;padding:8px 10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111;white-space:wrap;"
                      >
                        @if(businessInfo?.currencySymbolPosition === 'left')
                          {{ businessInfo?.currencyCode || 'USD' }} {{ Number(specialtyItemShoppingFee).toFixed(2) }}
                        @else
                          {{ Number(specialtyItemShoppingFee).toFixed(2) }} {{ businessInfo?.currencyCode || 'USD' }}
                        @endif
                      </td>
                    </tr>
                  @endif

                  @if(order?.deliveryCharge && Number(order.deliveryCharge) > 0)
                    <tr>
                      <td
                        colspan="3"
                        align="right"
                        style="border:1px solid #e1e5ea;padding:8px 10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111;"
                      >
                        {{ deliveryFeeLabel || 'Delivery Fee' }}
                      </td>
                      <td
                        align="center"
                        style="border:1px solid #e1e5ea;padding:8px 10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111;white-space:wrap;"
                      >
                        @if(businessInfo?.currencySymbolPosition === 'left')
                          {{ businessInfo?.currencyCode || 'USD' }} {{ Number(order.deliveryCharge).toFixed(2) }}
                        @else
                          {{ Number(order.deliveryCharge).toFixed(2) }} {{ businessInfo?.currencyCode || 'USD' }}
                        @endif
                      </td>
                    </tr>
                  @endif

                  @if(serviceCharge && Number(serviceCharge) > 0)
                    <tr>
                      <td
                        colspan="3"
                        align="right"
                        style="border:1px solid #e1e5ea;padding:8px 10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111;"
                      >
                        Service Charge
                      </td>
                      <td
                        align="center"
                        style="border:1px solid #e1e5ea;padding:8px 10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111;white-space:wrap;"
                      >
                        @if(businessInfo?.currencySymbolPosition === 'left')
                          {{ businessInfo?.currencyCode || 'USD' }} {{ Number(serviceCharge).toFixed(2) }}
                        @else
                          {{ Number(serviceCharge).toFixed(2) }} {{ businessInfo?.currencyCode || 'USD' }}
                        @endif
                      </td>
                    </tr>
                  @endif

                  @if(order?.discount && Number(order.discount) > 0)
                    <tr>
                      <td
                        colspan="3"
                        align="right"
                        style="border:1px solid #e1e5ea;padding:8px 10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111;"
                      >
                        Discount
                      </td>
                      <td
                        align="center"
                        style="border:1px solid #e1e5ea;padding:8px 10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111;white-space:wrap;"
                      >
                        @if(businessInfo?.currencySymbolPosition === 'left')
                          -{{ businessInfo?.currencyCode || 'USD' }} {{ Number(order.discount).toFixed(2) }}
                        @else
                          -{{ Number(order.discount).toFixed(2) }} {{ businessInfo?.currencyCode || 'USD' }}
                        @endif
                      </td>
                    </tr>
                  @endif
                  
                  @if(order?.manualDiscount && Number(order.manualDiscount) > 0)
                    <tr>
                      <td
                        colspan="3"
                        align="right"
                        style="border:1px solid #e1e5ea;padding:8px 10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111;"
                      >
                        Additional Discount
                      </td>
                      <td
                        align="center"
                        style="border:1px solid #e1e5ea;padding:8px 10px;font-family:Arial,Helvetica,sans-serif;font-size:13px;color:#111;white-space:wrap;"
                      >
                        @if(businessInfo?.currencySymbolPosition === 'left')
                          -{{ businessInfo?.currencyCode || 'USD' }} {{ Number(order.manualDiscount).toFixed(2) }}
                        @else
                          -{{ Number(order.manualDiscount).toFixed(2) }} {{ businessInfo?.currencyCode || 'USD' }}
                        @endif
                      </td>
                    </tr>
                  @endif
                  
                  <tr>
                    <td
                      colspan="3"
                      align="right"
                      style="border:1px solid #e1e5ea;padding:10px;font-family:Arial,Helvetica,sans-serif;font-size:14px;color:#111;font-weight:bold;"
                    >
                      Total
                    </td>
                    <td
                      align="center"
                      style="border:1px solid #e1e5ea;padding:10px;font-family:Arial,Helvetica,sans-serif;font-size:14px;color:#111;font-weight:bold;white-space:wrap;"
                    >
                      @if(businessInfo?.currencySymbolPosition === 'left')
                        {{ businessInfo?.currencyCode || 'USD' }} {{ Number(order?.grandTotal || 0).toFixed(2) }}
                      @else
                        {{ Number(order?.grandTotal || 0).toFixed(2) }} {{ businessInfo?.currencyCode || 'USD' }}
                      @endif
                    </td>
                  </tr>
                </table>
              </td>
            </tr>

            <!-- Payment status -->
            <tr>
              <td align="right" style="padding-top:8px;font-family:Arial,Helvetica,sans-serif;font-size:12px;">
                Status:
              <strong style="color:#0b63c9;">
                  {{ order?.paymentStatus === 'paid'
                    ? 'Paid'
                    : (order?.paymentStatus === 'unpaid' ? 'Unpaid' : 'Payment Requested') }}
              </strong>
              </td>
            </tr>

            <!-- Footer -->
            <tr>
              <td
                align="center"
                style="padding:16px 0 8px 0;font-family:Arial,Helvetica,sans-serif;font-size:12px;color:#888;"
              >
                Thank you for allowing me to manage your catering needs. Your order has been delivered. Kindly submit payment for the above invoice
              </td>
            </tr>

          </table>
        </td>
      </tr>
    </table>
  </body>
</html>
